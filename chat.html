<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥½äº«_haoxiang</title>
    <!-- å¼•å…¥æ ·å¼ -->
  <link rel="stylesheet" href="./css/element.css">
  <link href="./css/main.css" rel="stylesheet">
  <link href="./css/chat.css" rel="stylesheet">
</head>
<body>
    <div id="app">
      <div class="header">
        <div class="search-input">
          <el-input size="mini" placeholder="æœç´¢ðŸ”">
            <i slot="prefix" class="el-input__icon el-icon-search"></i>
          </el-input>
        </div>
      </div>
      <div class="chats-list">
        <div class="chat-box" @click="toMsgDetail(chat.id)" :class="{self:chat.fromId==user.id}" v-for="chat in chats">
          <div class="user-icon"><img :src="chat.toIcon || '/imgs/icons/default-icon.png'" alt=""></div>
          <div class="chat-nickname">{{getNickname(chat)}}</div>
        </div>
      </div>
      <foot-bar :active-btn="3"></foot-bar>
    </div>
    <script src="./js/vue.js"></script>
    <script src="./js/axios.min.js"></script>
    <!-- å¼•å…¥ç»„ä»¶åº“ -->
    <script src="./js/element.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/footer.js"></script>
    <script>
      const app = new Vue({
        el: "#app",
        data: {
          user: "",
          activeName: "1",
          info: {},
          chats:[],
          params: {
            minTime: 0, // ä¸Šä¸€æ¬¡æ‹‰å–åˆ°çš„æ—¶é—´æˆ³
            offset: 0, // åç§»é‡
          },
          count: 5,
          isReachBottom: false,
        },
        created() {
          this.queryUser();
        },
        methods: {
          load() {
            this.count += 2;
          },
          goBack() {
            history.back();
          },
          onScroll(e) {
            let scrollTop = e.target.scrollTop;
            let offsetHeight = e.target.offsetHeight;
            let scrollHeight = e.target.scrollHeight;
            if (scrollTop === 0) {
              // åˆ°é¡¶éƒ¨äº†ï¼ŒæŸ¥è¯¢ä¸€æ¬¡
              this.queryBlogsOfFollow(true);
            } else if (scrollTop + offsetHeight + 1 > scrollHeight && !this.isReachBottom) {
              this.isReachBottom = true
              // å†æ¬¡æŸ¥è¯¢ä¸‹ä¸€é¡µæ•°æ®
              this.queryBlogsOfFollow();
            } else {
              this.isReachBottom = false
            }
          },
          queryUser() {
            // æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
            axios.get("/user/me")
              .then(({data}) => {
                // ä¿å­˜ç”¨æˆ·
                this.user = data;
                this.queryChats();
              })
              .catch(err => {
                location.href = "login.html"
              })
          },
          queryChats(){
            axios.get("/chat/myChats?id=" + this.user.id)
              .then(({data}) => {
                // ä¿å­˜ç”¨æˆ·
                this.chats = data;
              })
              .catch(err => {
                location.href = "login.html"
              })
          },
          toMsgDetail(id) {
            location.href = "/msg.html?id=" + id;
          },
          getNickname(chat){
            if(chat.fromNickname === this.user.nickName){
              return chat.toNickname;
            }else{
              return chat.fromNickname;
            }
          }
        },
      })
    </script>
</body>
</html>